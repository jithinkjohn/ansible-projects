---
# roles/users/tasks/main.yml

- name: Ensure devopsuser exists
  user:
    name: devopsuser
    comment: "Baseline admin user"
    shell: /bin/bash
    state: present
    groups: wheel
    append: yes
  become: yes

- name: Set password for devopsuser (hashed)
  user:
    name: devopsuser
    password: "{{ '1234' | password_hash('sha512') }}"
  become: yes

- name: Ensure .ssh directory exists for devopsuser
  file:
    path: /home/devopsuser/.ssh
    state: directory
    owner: devopsuser
    group: devopsuser
    mode: 0700
  become: yes

- name: Add authorized keys for devopsuser
  authorized_key:
    user: devopsuser
    key: "{{ lookup('file', 'files/devopsuser.pub') }}"
  become: yes

